<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../../imgs/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="../css/style.css">
    <script src="../../js/carregarInformacoes.js"></script>
    <script src="../../js/sessao.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <title>Estufas</title>
</head>

<body onload="validarSessao(), exibirEstufas()" >

    <section class="menu-lateral">
        <div class="identificacao">
            <h1 id="nome_empresa">Empresa</h1>
            <h2 id="b_usuario">Usuário</h2>
        </div>

        <div>
            <a href="../Estufas/Estufas.html"><button class="btn-estufa" id="btn-ativo-menu">Estufas</button></a>
            <a href="../Gerenciar/Gerenciar.html"><button class="btn-gerenciar">Gerenciamento</button></a>
        </div>
        <div>
            <a><button onclick="limparSessao()" class="btn-sair">Sair</button></a>

            <img src="../img/Logo SmartFarm Branco.png" alt="Logo da SmartFarm">
        </div>
    </section>

    <section class="main-section-estufas">
        <nav>
            <div class="IndicadorProblemas" id="qtd_problemas_atual">
                <h5>Estufas com Problemas</h5>
                <p>20/<span id="qtd_estufas_empresa_kpi1">qtdEstufas</span></p>
            </div>
            <div class="IndicadorProblemas" id="qtd_semana">
                <h5>Problemas na última Semana</h5>
                <p>30/<span id="qtd_estufas_empresa_kpi2">qtdEstufas</span></p>
            </div>
            <div class="IndicadorProblemas" id="qtd_mes">
                <h5>Problemas no Mês</h5>
                <p>50/<span id="qtd_estufas_empresa_kpi3">qtdEstufas</span></p>
            </div>
        </nav>


        <div class="main-content">
            <div class="estufas" id="estufas">


            </div>
            <div class="graficos-global">
                <div class="gráfico-global">
                    <canvas id="grafico1"></canvas>
                </div>
                <div class="gráfico-global">
                    <canvas id="grafico2"></canvas>
                </div>
                <div class="gráfico-global">
                    <canvas id="grafico3"></canvas>
                </div>
            </div>
        </div>




    </section>

</body>

</html>

<script>
    const stringEstufas = (sessionStorage.getItem('ESTUFAS'));

    const arrayEstufas = JSON.parse(stringEstufas);

    const qtdEstufas = arrayEstufas.length

    qtd_estufas_empresa_kpi1.innerHTML = qtdEstufas
    qtd_estufas_empresa_kpi2.innerHTML = qtdEstufas
    qtd_estufas_empresa_kpi3.innerHTML = qtdEstufas

    function exibirEstufas() {
        JSON.parse(sessionStorage.ESTUFAS).forEach(item => {
            document.getElementById("estufas").innerHTML += `
                    <div class="estufa" style="background-color: rgb(206, 6, 6);">
                        <h1>Estufa ${item.id}</h1>
                        <img src="../img/critico.png">
                        <a href="../Dashboard/historico.html">Visualizar </a>
                    </div>
                    `
        });
    }

    // <div class="card-aquario">
    //     <div class="title-aquario">
    //         <h1>Estufa ${item.id}</h1>
    //     </div>
    //     <div class="desc-aquario">
    //     <div class="temperatura">
    //         <p id="temp_aquario_${item.id}">-°C</p>
    //     </div>
    //         <div class="cor-alerta" id="card_${item.id}"></div>
    //     </div>
    // </div>





    const estufas = document.getElementById('estufas');

    // Função para ordenar por cor de fundo

    function mostrarEstufasAntigo() {
        for (let i = 0; i < 100; i++) {
            const div = document.createElement('div');
            div.className = 'estufa';

            // div.style.backgroundColor = colors[i % colors.length];

            const titulo = document.createElement('h1');
            titulo.textContent = 'Estufa ' + (i + 1);

            const img = document.createElement('img');


            const a = document.createElement('a');
            a.textContent = 'Visualizar ';
            a.href = '../Dashboard/historico.html'

            div.appendChild(titulo);
            div.appendChild(img);
            div.appendChild(a);

            if (i < 20) {
                div.style.backgroundColor = '#CE0606';
                img.src = '../img/critico.png'
            } else if (i < 50) {
                div.style.backgroundColor = '#E7D31B';
                img.src = '../img/alerta.png'
            } else {
                div.style.backgroundColor = '#2A9C0D';
                img.src = '../img/ok.png'
            }

            estufas.appendChild(div);
        }

    }







</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


<script>
    var ctx = document.getElementById('grafico1').getContext('2d');

    var grafico1 = new Chart(ctx, {
        type: 'bar', // Tipo do gráfico: bar, line, pie, etc.
        data: {
            labels: ['Fevereiro', 'Março', 'Abril', 'Maio'], // Quantidade de vezes que ficou "Crítico" nos últimos quatro meses
            datasets: [{
                label: 'Quantidade de Problemas Mensais', // Rótulo do conjunto de dados
                data: [12, 19, 3, 5, 2, 3], // Dados para o gráfico
                backgroundColor: [
                    'rgba(15, 200, 132, 1)'

                ],
            }]
        },
        options: {
            responsive: true, // Torna o gráfico responsivo
            maintainAspectRatio: false, // Permite que o gráfico preencha o contêiner
            scales: {
                y: {
                    beginAtZero: true // Iniciar o eixo y no zero
                }
            },
            plugins: {
                legend: {
                    labels: {
                        font: {
                            weight: 'bolder' // Deixa a letra da legenda mais grossa
                        },
                        backgroundColor: 'green',
                        boxWidth: 20, // Largura do quadrado da legenda
                        boxHeight: 10, // Altura do quadrado da legenda (Chart.js 3.7.0+)
                        usePointStyle: true, // Usar o estilo de ponto (círculo) ao invés do quadrado
                        pointStyle: 'circle'
                    }
                }
            }
        }
    });





    var ctx = document.getElementById('grafico2').getContext('2d');

    var grafico2 = new Chart(ctx, {
        type: 'bar', // Tipo do gráfico: bar, line, pie, etc.
        data: {
            labels: ['Semana 1', 'Semana 2', 'Semana 3', 'Semana 4'], // Quantidade de vezes que ficou "Crítico" nas últimas 4 semanas.
            datasets: [{
                label: 'Quantidade de Problemas Semanais', // Rótulo do conjunto de dados
                data: [12, 19, 3, 5, 2, 3], // Dados para o gráfico
                backgroundColor: [
                    'rgba(15, 200, 132, 1)'

                ],
            }]
        },
        options: {
            responsive: true, // Torna o gráfico responsivo
            maintainAspectRatio: false, // Permite que o gráfico preencha o contêiner
            scales: {
                y: {
                    beginAtZero: true // Iniciar o eixo y no zero
                }
            },
            plugins: {
                legend: {
                    labels: {
                        font: {
                            weight: 'bolder' // Deixa a letra da legenda mais grossa
                        },
                        backgroundColor: 'green',
                        boxWidth: 20, // Largura do quadrado da legenda
                        boxHeight: 10, // Altura do quadrado da legenda (Chart.js 3.7.0+)
                        usePointStyle: true, // Usar o estilo de ponto (círculo) ao invés do quadrado
                        pointStyle: 'circle'
                    }
                }
            }
        }
    });

    var ctx = document.getElementById('grafico3').getContext('2d');

    var grafico3 = new Chart(ctx, {
        type: 'bar', // Tipo do gráfico: bar, line, pie, etc.
        data: {
            labels: ['Segunda', 'Terça', 'Quarta', 'Quinta'], // Rótulos do eixo x
            datasets: [{
                label: 'Quantidade de Problemas Diários', // Quantidade de vezes que ficou "Crítico" nos últimos 4 dias
                data: [12, 19, 3, -5, 2, 3], // Dados para o gráfico
                backgroundColor: [
                    'rgba(15, 200, 132, 1)'

                ],
            }]
        },
        options: {
            responsive: true, // Torna o gráfico responsivo
            maintainAspectRatio: false, // Permite que o gráfico preencha o contêiner
            scales: {
                y: {
                    beginAtZero: true // Iniciar o eixo y no zero
                }
            },
            plugins: {
                legend: {
                    labels: {
                        font: {
                            weight: 'bolder' // Deixa a letra da legenda mais grossa
                        },
                        backgroundColor: 'green',
                        boxWidth: 20, // Largura do quadrado da legenda
                        boxHeight: 10, // Altura do quadrado da legenda (Chart.js 3.7.0+)
                        usePointStyle: true, // Usar o estilo de ponto (círculo) ao invés do quadrado
                        pointStyle: 'circle'
                    }
                }
            }
        }
    });
</script>